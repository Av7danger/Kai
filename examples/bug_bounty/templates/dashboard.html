{% extends "base.html" %}

{% block title %}Dashboard - Bug Bounty Hunter Pro{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
    <a href="{{ url_for('add_target') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add Target
    </a>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-crosshairs fa-2x mb-2"></i>
                <h3>{{ total_targets }}</h3>
                <p class="mb-0">Total Targets</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-shield-alt fa-2x mb-2"></i>
                <h3>{{ total_vulns }}</h3>
                <p class="mb-0">Vulnerabilities</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-dollar-sign fa-2x mb-2"></i>
                <h3>${{ "%.0f"|format(total_earnings) }}</h3>
                <p class="mb-0">Estimated Earnings</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-search fa-2x mb-2"></i>
                <h3>{{ active_scans }}</h3>
                <p class="mb-0">Active Scans</p>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-crosshairs"></i> Recent Targets</h5>
            </div>
            <div class="card-body">
                {% if recent_targets %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Domain</th>
                                    <th>Status</th>
                                    <th>Vulns</th>
                                    <th>Payout</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for target in recent_targets %}
                                <tr>
                                    <td>{{ target[0] }}</td>
                                    <td><span class="status-{{ target[1] }}">{{ target[1]|title }}</span></td>
                                    <td>{{ target[2] }}</td>
                                    <td>${{ "%.0f"|format(target[3]) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No targets yet. <a href="{{ url_for('add_target') }}">Add your first target</a>!</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-shield-alt"></i> Recent Vulnerabilities</h5>
            </div>
            <div class="card-body">
                {% if recent_vulns %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Severity</th>
                                    <th>Payout</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for vuln in recent_vulns %}
                                <tr>
                                    <td>{{ vuln[0][:30] }}{% if vuln[0]|length > 30 %}...{% endif %}</td>
                                    <td><span class="severity-{{ vuln[1]|lower }}">{{ vuln[1] }}</span></td>
                                    <td>${{ "%.0f"|format(vuln[2]) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No vulnerabilities found yet. Start scanning targets!</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-bolt"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <a href="{{ url_for('add_target') }}" class="btn btn-outline-primary btn-lg w-100 mb-2">
                            <i class="fas fa-plus fa-2x d-block mb-2"></i>
                            Add New Target
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('targets') }}" class="btn btn-outline-success btn-lg w-100 mb-2">
                            <i class="fas fa-search fa-2x d-block mb-2"></i>
                            Start Scanning
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('vulnerabilities') }}" class="btn btn-outline-warning btn-lg w-100 mb-2">
                            <i class="fas fa-shield-alt fa-2x d-block mb-2"></i>
                            View Vulnerabilities
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="{{ url_for('reports') }}" class="btn btn-outline-info btn-lg w-100 mb-2">
                            <i class="fas fa-chart-bar fa-2x d-block mb-2"></i>
                            Generate Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gemini AI Prompt Generator -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card gemini-prompt-card">
            <div class="card-header">
                <h5><i class="fas fa-robot"></i> Gemini AI Bug Hunter Context</h5>
            </div>
            <div class="card-body">
                <p class="mb-3">Generate a complete context file to give Gemini AI for autonomous bug bounty hunting:</p>
                
                <form id="promptForm" class="mb-3">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="targetDomain" class="form-label">Target Domain</label>
                                <input type="text" class="form-control" id="targetDomain" placeholder="example.com" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="industry" class="form-label">Industry Type</label>
                                <select class="form-control" id="industry">
                                    <option value="technology">Technology</option>
                                    <option value="fintech">Fintech</option>
                                    <option value="healthcare">Healthcare</option>
                                    <option value="ecommerce">E-commerce</option>
                                    <option value="saas">SaaS</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="criticalPayout" class="form-label">Critical Payout ($)</label>
                                <input type="number" class="form-control" id="criticalPayout" value="5000">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="highPayout" class="form-label">High Payout ($)</label>
                                <input type="number" class="form-control" id="highPayout" value="1000">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="timeBudget" class="form-label">Time Budget (hours)</label>
                                <input type="number" class="form-control" id="timeBudget" value="4">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="generatePrompt()">
                        <i class="fas fa-magic"></i> Generate Gemini Context
                    </button>
                </form>
                
                <div id="promptOutput" style="display: none;">
                    <h6>📋 Generated Context (Copy this to Gemini AI):</h6>
                    <div class="prompt-content" id="promptContent"></div>
                    <div class="mt-3">
                        <button class="btn btn-success" onclick="copyPrompt()">
                            <i class="fas fa-copy"></i> Copy to Clipboard
                        </button>
                        <button class="btn btn-info" onclick="downloadPrompt()">
                            <i class="fas fa-download"></i> Download as Text File
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh dashboard every 30 seconds
setInterval(function() {
    location.reload();
}, 30000);

// Generate Gemini prompt
function generatePrompt() {
    const target = document.getElementById('targetDomain').value;
    const industry = document.getElementById('industry').value;
    const criticalPayout = document.getElementById('criticalPayout').value;
    const highPayout = document.getElementById('highPayout').value;
    const timeBudget = document.getElementById('timeBudget').value;
    
    if (!target) {
        alert('Please enter a target domain');
        return;
    }
    
    const prompt = `You are a professional bug bounty hunter AI. Your job is to find security vulnerabilities for maximum profit.

🎯 TARGET: ${target}
🏭 INDUSTRY: ${industry}
💰 PAYOUT STRUCTURE:
   • Critical: $${criticalPayout}
   • High: $${highPayout}
   • Medium: $300
   • Low: $100

⏱️ TIME BUDGET: ${timeBudget} hours

🔍 WHAT TO FIND (prioritized by payout):
1. SQL Injection - $${criticalPayout}+
2. Remote Code Execution - $${criticalPayout}+
3. Authentication bypass - $${Math.round(criticalPayout * 0.6)}+
4. Stored XSS - $${highPayout}+
5. Business logic flaws - $${highPayout}+
6. API security issues - $${highPayout}+

🎯 WHAT TO TEST:
- Login/authentication systems
- Payment processing (if ${industry === 'fintech' || industry === 'ecommerce' ? 'YES - HIGH PRIORITY' : 'applicable'})
- User data handling (if ${industry === 'healthcare' ? 'YES - HIPAA COMPLIANCE' : 'applicable'})
- File upload functionality
- API endpoints and integrations
- Admin panels and privileged areas

🚫 WHAT NOT TO TEST:
- Don't attack other users
- Don't break or damage systems
- Only test ${target} and its subdomains
- No denial of service attacks
- No brute force attacks

🔬 TESTING METHODOLOGY:
1. Reconnaissance (${Math.round(timeBudget * 0.2)} hours):
   - Discover subdomains: *.${target}
   - Identify technology stack
   - Map attack surface

2. Vulnerability Testing (${Math.round(timeBudget * 0.6)} hours):
   - SQL injection: ' OR 1=1-- 
   - XSS: <script>alert('xss')</script>
   - Authentication bypass attempts
   - Business logic testing
   - API security assessment

3. Reporting (${Math.round(timeBudget * 0.2)} hours):
   - Document clear reproduction steps
   - Explain business impact
   - Provide remediation recommendations

📊 SUCCESS CRITERIA:
✅ Find at least 1 vulnerability worth $300+
✅ Create reproducible proof-of-concept
✅ Document clear business impact
✅ Complete within ${timeBudget} hour time budget

${industry === 'fintech' ? '💳 FINTECH FOCUS: Payment bypass, transaction manipulation, financial data exposure' : ''}
${industry === 'healthcare' ? '🏥 HEALTHCARE FOCUS: Patient data exposure, HIPAA violations, medical record access' : ''}
${industry === 'ecommerce' ? '🛒 E-COMMERCE FOCUS: Price manipulation, payment bypass, user account takeover' : ''}

🚀 START TESTING ${target.toUpperCase()} NOW!

Be methodical, thorough, and profit-focused. Every minute should be optimized for finding high-payout vulnerabilities while staying within legal and ethical boundaries.`;
    
    document.getElementById('promptContent').textContent = prompt;
    document.getElementById('promptOutput').style.display = 'block';
    document.getElementById('promptOutput').scrollIntoView({ behavior: 'smooth' });
}

// Copy prompt to clipboard
function copyPrompt() {
    const content = document.getElementById('promptContent').textContent;
    navigator.clipboard.writeText(content).then(function() {
        alert('✅ Prompt copied to clipboard! Paste it into Gemini AI.');
    });
}

// Download prompt as text file
function downloadPrompt() {
    const content = document.getElementById('promptContent').textContent;
    const target = document.getElementById('targetDomain').value;
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = \`gemini_context_\${target.replace('.', '_')}.txt\`;
    a.click();
    window.URL.revokeObjectURL(url);
    alert('✅ Context file downloaded! Upload it to Gemini AI.');
}
</script>
{% endblock %}
