<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¦ˆ Kali Linux Tools & Payload Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css" rel="stylesheet">
    <style>
        :root {
            --kali-primary: #00ff00;
            --kali-secondary: #1a1a1a;
            --kali-accent: #ff6b35;
            --kali-dark: #0a0a0a;
            --kali-light: #2a2a2a;
        }

        body {
            background: linear-gradient(135deg, var(--kali-dark) 0%, var(--kali-light) 100%);
            color: #ffffff;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(26, 26, 26, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--kali-primary);
        }

        .navbar-brand {
            color: var(--kali-primary) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .card {
            background: rgba(42, 42, 42, 0.9);
            border: 1px solid var(--kali-primary);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 0, 0.3);
        }

        .card-header {
            background: linear-gradient(45deg, var(--kali-primary), var(--kali-accent));
            color: var(--kali-dark);
            font-weight: bold;
            border-bottom: 1px solid var(--kali-primary);
        }

        .btn-kali {
            background: linear-gradient(45deg, var(--kali-primary), var(--kali-accent));
            border: none;
            color: var(--kali-dark);
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-kali:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.4);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-installed {
            background-color: var(--kali-primary);
            box-shadow: 0 0 10px var(--kali-primary);
        }

        .status-not-installed {
            background-color: #ff4444;
            box-shadow: 0 0 10px #ff4444;
        }

        .tool-category {
            background: rgba(0, 255, 0, 0.1);
            border-left: 4px solid var(--kali-primary);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .payload-template {
            background: rgba(255, 107, 53, 0.1);
            border-left: 4px solid var(--kali-accent);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .system-metric {
            text-align: center;
            padding: 20px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--kali-primary);
        }

        .metric-label {
            font-size: 0.9rem;
            color: #cccccc;
        }

        .progress {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
        }

        .progress-bar {
            background: linear-gradient(45deg, var(--kali-primary), var(--kali-accent));
        }

        .terminal-output {
            background: var(--kali-dark);
            color: var(--kali-primary);
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--kali-primary);
        }

        .loading-spinner {
            border: 3px solid rgba(0, 255, 0, 0.3);
            border-top: 3px solid var(--kali-primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .risk-high { color: #ff4444; }
        .risk-medium { color: #ffaa00; }
        .risk-low { color: #44ff44; }

        .encoding-badge {
            background: rgba(0, 255, 0, 0.2);
            color: var(--kali-primary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .payload-generator {
            background: rgba(42, 42, 42, 0.95);
            border: 2px solid var(--kali-accent);
            border-radius: 10px;
            padding: 20px;
        }

        .form-control, .form-select {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--kali-primary);
            color: #ffffff;
        }

        .form-control:focus, .form-select:focus {
            background: rgba(26, 26, 26, 0.9);
            border-color: var(--kali-accent);
            color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .form-control::placeholder {
            color: #888888;
        }

        .toast {
            background: rgba(42, 42, 42, 0.95);
            border: 1px solid var(--kali-primary);
            color: #ffffff;
        }

        .toast-header {
            background: linear-gradient(45deg, var(--kali-primary), var(--kali-accent));
            color: var(--kali-dark);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt"></i> Kali Tools & Payload Dashboard
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home"></i> Main Dashboard</a>
                <a class="nav-link" href="/security"><i class="fas fa-lock"></i> Security</a>
                <a class="nav-link active" href="/kali"><i class="fas fa-terminal"></i> Kali Tools</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- System Overview -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body system-metric">
                        <div class="metric-value" id="cpu-usage">--</div>
                        <div class="metric-label">CPU Usage</div>
                        <div class="progress mt-2">
                            <div class="progress-bar" id="cpu-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body system-metric">
                        <div class="metric-value" id="memory-usage">--</div>
                        <div class="metric-label">Memory Usage</div>
                        <div class="progress mt-2">
                            <div class="progress-bar" id="memory-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body system-metric">
                        <div class="metric-value" id="disk-usage">--</div>
                        <div class="metric-label">Disk Usage</div>
                        <div class="progress mt-2">
                            <div class="progress-bar" id="disk-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body system-metric">
                        <div class="metric-value" id="tools-installed">--</div>
                        <div class="metric-label">Tools Installed</div>
                        <div class="progress mt-2">
                            <div class="progress-bar" id="tools-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Kali Linux Tools -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-tools"></i> Kali Linux Security Tools
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <button class="btn btn-kali me-2" onclick="refreshToolsStatus()">
                                <i class="fas fa-sync-alt"></i> Refresh Status
                            </button>
                            <button class="btn btn-kali me-2" onclick="updateAllTools()">
                                <i class="fas fa-download"></i> Update All Tools
                            </button>
                            <button class="btn btn-kali" onclick="optimizeSystem()">
                                <i class="fas fa-cogs"></i> Optimize System
                            </button>
                        </div>
                        
                        <div id="tools-status" class="tool-grid">
                            <!-- Tools will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payload Generator -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-bomb"></i> Payload Generator
                    </div>
                    <div class="card-body">
                        <div class="payload-generator">
                            <div class="mb-3">
                                <label class="form-label">Template</label>
                                <select class="form-select" id="payload-template">
                                    <option value="">Select a template...</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Parameters (JSON)</label>
                                <textarea class="form-control" id="payload-parameters" rows="3" placeholder='{"param": "value"}'></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Encoding</label>
                                <div id="encoding-options">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" value="url" id="encode-url">
                                        <label class="form-check-label" for="encode-url">URL</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" value="html" id="encode-html">
                                        <label class="form-check-label" for="encode-html">HTML</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" value="base64" id="encode-base64">
                                        <label class="form-check-label" for="encode-base64">Base64</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" value="hex" id="encode-hex">
                                        <label class="form-check-label" for="encode-hex">Hex</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <button class="btn btn-kali" onclick="generatePayload()">
                                    <i class="fas fa-magic"></i> Generate Payload
                                </button>
                                <button class="btn btn-kali ms-2" onclick="savePayload()">
                                    <i class="fas fa-save"></i> Save Payload
                                </button>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Generated Payload</label>
                                <textarea class="form-control" id="generated-payload" rows="4" readonly></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payload Templates and Statistics -->
        <div class="row mt-4">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list"></i> Payload Templates
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="template-search" placeholder="Search templates...">
                        </div>
                        <div id="payload-templates">
                            <!-- Templates will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-bar"></i> Payload Statistics
                    </div>
                    <div class="card-body">
                        <div id="payload-stats">
                            <!-- Statistics will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Terminal -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-terminal"></i> System Terminal
                    </div>
                    <div class="card-body">
                        <div class="terminal-output" id="terminal-output">
                            <div class="text-success">Kali Linux Tools Dashboard initialized...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-body">
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // Global variables
        let socket;
        let systemInfo = {};
        let toolsStatus = {};
        let payloadTemplates = {};
        let payloadStats = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            loadSystemInfo();
            loadToolsStatus();
            loadPayloadTemplates();
            loadPayloadStats();
            setupEventListeners();
            
            // Start real-time updates
            setInterval(updateSystemMetrics, 5000);
        });

        // Socket.IO initialization
        function initializeSocket() {
            socket = io('/realtime');
            
            socket.on('connect', function() {
                console.log('Connected to real-time updates');
                addTerminalMessage('Connected to real-time updates', 'success');
            });
            
            socket.on('tools_installed', function(data) {
                showToast('Tools installed successfully', 'success');
                loadToolsStatus();
            });
            
            socket.on('tools_updated', function(data) {
                showToast('Tools updated successfully', 'success');
                loadToolsStatus();
            });
            
            socket.on('tools_install_error', function(data) {
                showToast('Error installing tools: ' + data.error, 'error');
            });
            
            socket.on('tools_update_error', function(data) {
                showToast('Error updating tools: ' + data.error, 'error');
            });
        }

        // Load system information
        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/kali/system-info');
                const data = await response.json();
                
                if (data.status === 'success') {
                    systemInfo = data.system_info;
                    updateSystemMetrics();
                }
            } catch (error) {
                console.error('Failed to load system info:', error);
                addTerminalMessage('Failed to load system info: ' + error.message, 'error');
            }
        }

        // Update system metrics
        function updateSystemMetrics() {
            if (systemInfo.system) {
                // CPU usage
                const cpuInfo = systemInfo.system.cpu;
                if (cpuInfo && cpuInfo.processor) {
                    document.getElementById('cpu-usage').textContent = 'Active';
                    document.getElementById('cpu-progress').style.width = '75%';
                }
                
                // Memory usage
                const memoryInfo = systemInfo.system.memory;
                if (memoryInfo && memoryInfo.MemTotal) {
                    const total = parseInt(memoryInfo.MemTotal);
                    const available = parseInt(memoryInfo.MemAvailable);
                    const used = total - available;
                    const usagePercent = Math.round((used / total) * 100);
                    
                    document.getElementById('memory-usage').textContent = usagePercent + '%';
                    document.getElementById('memory-progress').style.width = usagePercent + '%';
                }
                
                // Disk usage
                const diskInfo = systemInfo.system.disk;
                if (diskInfo && diskInfo.df_output) {
                    document.getElementById('disk-usage').textContent = 'Active';
                    document.getElementById('disk-progress').style.width = '60%';
                }
            }
        }

        // Load tools status
        async function loadToolsStatus() {
            try {
                const response = await fetch('/api/kali/tools/status');
                const data = await response.json();
                
                if (data.status === 'success') {
                    toolsStatus = data.tools_status;
                    displayToolsStatus();
                    
                    // Update tools installed count
                    const installedCount = Object.values(toolsStatus).filter(tool => tool.installed).length;
                    const totalCount = Object.keys(toolsStatus).length;
                    const installPercent = Math.round((installedCount / totalCount) * 100);
                    
                    document.getElementById('tools-installed').textContent = installedCount + '/' + totalCount;
                    document.getElementById('tools-progress').style.width = installPercent + '%';
                }
            } catch (error) {
                console.error('Failed to load tools status:', error);
                addTerminalMessage('Failed to load tools status: ' + error.message, 'error');
            }
        }

        // Display tools status
        function displayToolsStatus() {
            const container = document.getElementById('tools-status');
            container.innerHTML = '';
            
            // Group tools by category
            const categories = {};
            Object.entries(toolsStatus).forEach(([name, tool]) => {
                if (!categories[tool.category]) {
                    categories[tool.category] = [];
                }
                categories[tool.category].push({ name, ...tool });
            });
            
            Object.entries(categories).forEach(([category, tools]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'tool-category';
                categoryDiv.innerHTML = `
                    <h6 class="text-success"><i class="fas fa-folder"></i> ${category.toUpperCase()}</h6>
                    ${tools.map(tool => `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <span class="status-indicator ${tool.installed ? 'status-installed' : 'status-not-installed'}"></span>
                                <strong>${tool.name}</strong>
                                <small class="text-muted d-block">${tool.description}</small>
                            </div>
                            <div>
                                ${tool.installed ? 
                                    `<span class="badge bg-success">Installed</span>` : 
                                    `<button class="btn btn-sm btn-kali" onclick="installTool('${tool.name}')">Install</button>`
                                }
                            </div>
                        </div>
                    `).join('')}
                `;
                container.appendChild(categoryDiv);
            });
        }

        // Install tool
        async function installTool(toolName) {
            try {
                const response = await fetch('/api/kali/tools/install', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tools: [toolName] })
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    showToast(`Installing ${toolName}...`, 'info');
                    addTerminalMessage(`Installing ${toolName}...`, 'info');
                }
            } catch (error) {
                console.error('Failed to install tool:', error);
                showToast('Failed to install tool: ' + error.message, 'error');
            }
        }

        // Update all tools
        async function updateAllTools() {
            try {
                const response = await fetch('/api/kali/tools/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    showToast('Updating all tools...', 'info');
                    addTerminalMessage('Updating all tools...', 'info');
                }
            } catch (error) {
                console.error('Failed to update tools:', error);
                showToast('Failed to update tools: ' + error.message, 'error');
            }
        }

        // Optimize system
        async function optimizeSystem() {
            try {
                const response = await fetch('/api/kali/optimize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tasks: ['system', 'performance', 'workspace'] })
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    showToast('System optimization completed', 'success');
                    addTerminalMessage('System optimization completed', 'success');
                }
            } catch (error) {
                console.error('Failed to optimize system:', error);
                showToast('Failed to optimize system: ' + error.message, 'error');
            }
        }

        // Load payload templates
        async function loadPayloadTemplates() {
            try {
                const response = await fetch('/api/payloads/templates');
                const data = await response.json();
                
                if (data.status === 'success') {
                    payloadTemplates = data.templates;
                    displayPayloadTemplates();
                    populateTemplateSelect();
                }
            } catch (error) {
                console.error('Failed to load payload templates:', error);
                addTerminalMessage('Failed to load payload templates: ' + error.message, 'error');
            }
        }

        // Display payload templates
        function displayPayloadTemplates() {
            const container = document.getElementById('payload-templates');
            container.innerHTML = '';
            
            Object.entries(payloadTemplates).forEach(([name, template]) => {
                const templateDiv = document.createElement('div');
                templateDiv.className = 'payload-template';
                templateDiv.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-warning">${template.name}</h6>
                            <p class="mb-1">${template.description}</p>
                            <small class="text-muted">Category: ${template.category} | Vector: ${template.attack_vector}</small>
                            <div class="mt-2">
                                <span class="badge risk-${template.risk_level}">${template.risk_level.toUpperCase()}</span>
                                ${template.tags.map(tag => `<span class="badge bg-secondary me-1">${tag}</span>`).join('')}
                            </div>
                            <div class="mt-2">
                                ${template.encoding.map(enc => `<span class="encoding-badge">${enc}</span>`).join('')}
                            </div>
                        </div>
                        <button class="btn btn-sm btn-kali" onclick="useTemplate('${name}')">Use</button>
                    </div>
                `;
                container.appendChild(templateDiv);
            });
        }

        // Populate template select
        function populateTemplateSelect() {
            const select = document.getElementById('payload-template');
            select.innerHTML = '<option value="">Select a template...</option>';
            
            Object.entries(payloadTemplates).forEach(([name, template]) => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = `${template.name} (${template.category})`;
                select.appendChild(option);
            });
        }

        // Use template
        function useTemplate(templateName) {
            document.getElementById('payload-template').value = templateName;
            const template = payloadTemplates[templateName];
            
            // Set default parameters
            document.getElementById('payload-parameters').value = JSON.stringify(template.parameters || {}, null, 2);
            
            // Set encoding options
            document.querySelectorAll('#encoding-options input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = template.encoding.includes(checkbox.value);
            });
        }

        // Generate payload
        async function generatePayload() {
            const templateName = document.getElementById('payload-template').value;
            const parameters = document.getElementById('payload-parameters').value;
            const encoding = Array.from(document.querySelectorAll('#encoding-options input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            
            if (!templateName) {
                showToast('Please select a template', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/payloads/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        template_name: templateName,
                        parameters: parameters ? JSON.parse(parameters) : {},
                        encoding: encoding
                    })
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    document.getElementById('generated-payload').value = data.payload;
                    showToast('Payload generated successfully', 'success');
                    addTerminalMessage(`Generated payload from template: ${templateName}`, 'success');
                }
            } catch (error) {
                console.error('Failed to generate payload:', error);
                showToast('Failed to generate payload: ' + error.message, 'error');
            }
        }

        // Save payload
        async function savePayload() {
            const payload = document.getElementById('generated-payload').value;
            const templateName = document.getElementById('payload-template').value;
            
            if (!payload) {
                showToast('No payload to save', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/payloads/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: templateName || 'Custom Payload',
                        payload: payload,
                        category: 'custom',
                        description: 'Generated payload',
                        tags: ['generated']
                    })
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    showToast('Payload saved successfully', 'success');
                    addTerminalMessage('Payload saved successfully', 'success');
                }
            } catch (error) {
                console.error('Failed to save payload:', error);
                showToast('Failed to save payload: ' + error.message, 'error');
            }
        }

        // Load payload statistics
        async function loadPayloadStats() {
            try {
                const response = await fetch('/api/payloads/statistics');
                const data = await response.json();
                
                if (data.status === 'success') {
                    payloadStats = data.statistics;
                    displayPayloadStats();
                }
            } catch (error) {
                console.error('Failed to load payload stats:', error);
            }
        }

        // Display payload statistics
        function displayPayloadStats() {
            const container = document.getElementById('payload-stats');
            container.innerHTML = `
                <div class="mb-3">
                    <h6>Total Templates</h6>
                    <div class="metric-value">${payloadStats.total_payloads || 0}</div>
                </div>
                <div class="mb-3">
                    <h6>Saved Payloads</h6>
                    <div class="metric-value">${payloadStats.saved_payloads || 0}</div>
                </div>
                <div class="mb-3">
                    <h6>Categories</h6>
                    ${Object.entries(payloadStats.categories || {}).map(([cat, count]) => `
                        <div class="d-flex justify-content-between">
                            <span>${cat}</span>
                            <span class="text-success">${count}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="mb-3">
                    <h6>Risk Levels</h6>
                    ${Object.entries(payloadStats.risk_levels || {}).map(([level, count]) => `
                        <div class="d-flex justify-content-between">
                            <span class="risk-${level}">${level}</span>
                            <span>${count}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Utility functions
        function refreshToolsStatus() {
            loadToolsStatus();
            showToast('Refreshing tools status...', 'info');
        }

        function addTerminalMessage(message, type = 'info') {
            const terminal = document.getElementById('terminal-output');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            
            terminal.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            terminal.scrollTop = terminal.scrollHeight;
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastBody = document.getElementById('toast-body');
            
            toastBody.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function setupEventListeners() {
            // Template search
            document.getElementById('template-search').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const templates = document.querySelectorAll('.payload-template');
                
                templates.forEach(template => {
                    const text = template.textContent.toLowerCase();
                    template.style.display = text.includes(searchTerm) ? 'block' : 'none';
                });
            });
        }
    </script>
</body>
</html> 