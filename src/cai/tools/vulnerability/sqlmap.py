import subprocess
import tempfile
import os

def run_sqlmap(url):
    """
    Run sqlmap on the given URL and return the results as a list (parsed from the output file).
    Requires sqlmap to be installed and in the system PATH.
    """
    with tempfile.NamedTemporaryFile(delete=False, suffix='.txt') as tmpfile:
        output_path = tmpfile.name
    try:
        cmd = [
            "sqlmap",
            "-u", url,
            "--batch",
            "--output-dir", os.path.dirname(output_path)
        ]
        subprocess.run(cmd, check=True)
        # sqlmap output is not always structured; you may need to parse the output file or logs
        # For now, just return the path to the output directory
        return {"output_dir": os.path.dirname(output_path)}
    finally:
        if os.path.exists(output_path):
            os.remove(output_path) 