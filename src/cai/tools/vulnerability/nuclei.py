import subprocess
import json
import tempfile
import os

def run_nuclei(urls, templates=None):
    """
    Run nuclei on the given list of URLs and return the results as a list of findings.
    Requires nuclei to be installed and in the system PATH.
    """
    with tempfile.NamedTemporaryFile(delete=False, suffix='.json') as tmpfile:
        output_path = tmpfile.name
    try:
        cmd = [
            "nuclei",
            "-l", "-",  # Read URLs from stdin
            "-json",
            "-o", output_path
        ]
        if templates:
            cmd += ["-t", templates]
        process = subprocess.Popen(cmd, stdin=subprocess.PIPE, text=True)
        process.communicate(input="\n".join(urls))
        process.wait()
        findings = []
        with open(output_path, "r", encoding="utf-8") as f:
            for line in f:
                if line.strip():
                    findings.append(json.loads(line))
        return findings
    finally:
        if os.path.exists(output_path):
            os.remove(output_path) 